# 배경

- 대학 교육 환경에서 안정적이고 고가용성을 갖춘 클라우드 인프라의 필요성 증대
- 상용 클라우드 서비스의 높은 비용을 대체할 수 있는 자체 인프라 구축 기술 요구
- 교육과 연구를 지원하기 위한 서비스 특성에 맞춘 가용성과 확장성 제공 필요

# 추진 목표

- 상용 수준의 고가용성 클라우드 인프라를 설계하고 구현
- 교육 및 연구 환경에 적합한 비용 효율적 고가용성 인프라 구축
- DRBD와 Pacemaker, OpenStack 등 오픈소스 기술을 활용한 안정적이고 확장 가능한 시스템 개발
- 서비스 중요도에 따라 차등화된 고가용성 전략 도입으로 운영 효율성 극대화
- VIP와 HAProxy를 통한 네트워크 트래픽 분리 및 안정적 데이터 관리 구현

# DRBD와 HAFS를 이용한 스토리지 미러링

## DRBD 기반 스토리지 미러링

- 각 노드의 NVMe 스토리지를 DRBD로 구성하여 실시간 데이터 복제를 수행
- DRBD는 블록 디바이스 레벨에서 IO 작업을 동기화하며, 주(primary) 노드에서만 파일 시스템이 마운트되도록 설정
- 장애 복구 시 DRBD가 자동으로 주 노드를 전환하고, 데이터 동기화 상태를 유지하며 Split-brain 방지를 위한 복구 절차를 제공

## HAFS 파일 시스템

- DRBD를 기반으로 HAFS를 구현하여 안정적인 데이터 저장을 지원
- Glance 이미지 데이터 및 Apache2 설정 파일을 HAFS 위에 저장하고, HAFS가 준비된 후에 해당 서비스가 시작되도록 Pacemaker로 관리
- 단일 노드에서만 파일 시스템이 마운트되며, Failover 상황에서 새로운 주 노드로 전환 후 파일 시스템이 자동 마운트되도록 구성

# Pacemaker 기반 서비스 관리

## Pacemaker를 통한 클러스터 자원 관리

- VIP(가상 IP)와 주요 서비스를 Pacemaker로 관리하여 노드 간 장애 복구를 자동화
- Pacemaker는 서비스 상태를 실시간으로 모니터링하며, 이상 상태 발생 시 주 노드를 전환하고 서비스를 재배치
- VIP를 각 노드에서 번갈아가며 바인딩해, 서비스 접근이 중단되지 않도록 보장

## 장애 시 서비스 전환(Failover)

- Glance 및 Keystone 등 주요 서비스는 장애 발생 시 자동으로 Failover가 진행되도록 설정
- DRBD 및 HAFS와 연계하여 데이터가 준비된 후 서비스가 시작되도록 구성하여 데이터 무결성 확보

# HAProxy로 부하 분산

## 부하 분산 및 로드 밸런싱 구성

- Nova, Glance, Neutron 등 주요 서비스를 HAProxy를 통해 라우팅하여 클러스터 내 부하를 분산
- HAProxy는 VIP-10G에 바인딩된 상태로 작동하며, 서비스 요청을 각 노드로 라우팅하여 서비스 간 트래픽 충돌을 방지
- 서비스가 Active-Active 및 Active-Standby 모드로 혼합 운영되며, Pacemaker와 연계해 서비스 상태를 지속적으로 관리

## 서비스 별도 설정

- Nova와 Neutron은 서비스 디스커버리 기능을 활용하여 VIP를 통해 등록된 노드로 요청을 전달
- Glance는 VIP와 HAProxy를 통해 단일 노드에서만 활성화된 상태로 동작하며, Failover 시에도 부하 분산 구조를 유지

# VIP를 활용한 네트워크 구분

## 1G와 10G 네트워크의 역할 분리

- 외부 접속이 필요한 Horizon 대시보드는 1G 네트워크를 통해 서비스하며, 내부 데이터 흐름이 중요한 Glance, Nova, Neutron 등은 10G 네트워크를 사용하도록 설정
- VIP를 활용해 내부 및 외부 트래픽이 적절히 분리되도록 구성하여 네트워크 충돌을 방지하고, 네트워크 대역폭 활용을 최적화

## 서비스별 네트워크 바인딩

- 각 서비스의 VIP를 Apache2와 HAProxy를 통해 설정하여 트래픽이 적합한 네트워크로 전달되도록 구성
- 특히, Nova와 Neutron은 10G 네트워크에 최적화된 방식으로 데이터 전송을 처리하며, 데이터 집약적 작업의 성능을 극대화

# 서비스 가용성 차등 적용

## 교육용 연구 서비스와 중요 서비스의 가용성 구분

- 일시적으로 사용되는 교육 및 연구 서비스는 기본 가용성 설정으로 운영하되, 장기적인 운영이 필요한 중요 서비스에는 DRBD와 Pacemaker를 적용하여 높은 안정성을 제공
- 예를 들어, Glance와 Keystone은 HAFS와 DRBD를 기반으로 한쪽 노드에서만 실행되며, 장애 시 Pacemaker를 통해 자동 Failover를 지원

## 서비스별 HA 구성 최적화

- Neutron과 Nova와 같은 일부 서비스는 Active-Active 모드로 운영하며, 가용성과 확장성을 강화
- 중요 서비스의 경우 데이터 무결성을 유지하며 단일 노드에서 안정적으로 동작할 수 있도록 Active-Standby 방식을 적용

# 비용 효율성 확보

## NVMe 스토리지와 DRBD 활용

- NVMe 기반 스토리지를 DRBD로 구성하여 데이터 복제와 저장 성능을 동시에 제공
- 상용 클라우드의 비싼 스토리지 솔루션 대신 오픈소스 기반 기술을 사용하여 비용 효율을 높임

## 오픈소스 기반 OpenStack 인프라 설계

- OpenStack의 다양한 서비스를 활용하여 상용 클라우드 수준의 기능과 가용성을 제공하면서도 자체 관리형 인프라로 운영비 절감
- 교육 기관의 특성을 고려해 기존 하드웨어를 최대한 활용하여 새로운 투자 비용을 줄이고, 유지보수와 확장성을 확보
